<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
<title>LinkedHashMap</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
<style type="text/css">

#wmd-preview h1  {
    color: #0077bb; /* 将标题改为蓝色 */
}</style>
</head>
<body class="theme theme-white">
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="uadv" id="linkedhashmap">LinkedHashMap</h1><p data-anchor-id="hn21"><code>集合</code></p><p data-anchor-id="lsuv"><a href="http://blog.zhoulychn.com/JavaSE/center.html" target="_blank">点击返回导航页</a></p><hr><p data-anchor-id="zoas"><div class="toc">
<ul>
<li><a href="#linkedhashmap">LinkedHashMap</a><ul>
<li><a href="#基础结构">基础结构</a></li>
<li><a href="#1-linkedhashmap">(1) LinkedHashMap</a></li>
<li><a href="#2-linknodelast">(2) linkNodeLast</a></li>
<li><a href="#3-reinitialize">(3) reinitialize</a></li>
<li><a href="#4-newnode">(4) newNode</a></li>
<li><a href="#5-afternoderemoval">(5) afterNodeRemoval</a></li>
<li><a href="#6-get">(6) get</a></li>
<li><a href="#7-containsvalue">(7) containsValue</a></li>
</ul>
</li>
</ul>
</div>
</p><hr><div class="md-section-divider"></div><h2 data-anchor-id="6zhy" id="基础结构">基础结构</h2><p data-anchor-id="d2tx"><strong>存储结构</strong>： <br>
主要继承自HashMap</p><p data-anchor-id="sl05"><strong>继承结构</strong>： <br>
<img src="http://static.zybuluo.com/zy380104192/ez24ptbit22vqr0ihfh6smlb/image_1c8uogdo61o1e1141n94988175k9.png" alt="image_1c8uogdo61o1e1141n94988175k9.png-14.1kB"></p><p data-anchor-id="z2sw">HashMap和双向链表合二为一即是LinkedHashMap。所谓LinkedHashMap，其落脚点在HashMap，因此更准确地说，它是一个将所有Entry节点链入一个双向链表的HashMap。</p><p data-anchor-id="30oz">由于LinkedHashMap是HashMap的子类，所以LinkedHashMap自然会拥有HashMap的所有特性。</p><p data-anchor-id="fd68">比如，LinkedHashMap的元素存取过程基本与HashMap基本类似，只是在细节实现上稍有不同。</p><p data-anchor-id="1h40">当然，这是由LinkedHashMap本身的特性所决定的，因为它额外维护了一个双向链表用于保持迭代顺序。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="7adg"><ol class="linenums"><li class="L0"><code class="language-java"><span class="com">//主要属性如下</span></code></li><li class="L1"><code class="language-java"></code></li><li class="L2"><code class="language-java"><span class="com">//表头</span></code></li><li class="L3"><code class="language-java"><span class="kwd">transient</span><span class="pln"> </span><span class="typ">LinkedHashMap</span><span class="pun">.</span><span class="typ">Entry</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> head</span><span class="pun">;</span></code></li><li class="L4"><code class="language-java"></code></li><li class="L5"><code class="language-java"><span class="com">//表尾</span></code></li><li class="L6"><code class="language-java"><span class="kwd">transient</span><span class="pln"> </span><span class="typ">LinkedHashMap</span><span class="pun">.</span><span class="typ">Entry</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> tail</span><span class="pun">;</span></code></li><li class="L7"><code class="language-java"></code></li><li class="L8"><code class="language-java"><span class="com">//是否有序</span></code></li><li class="L9"><code class="language-java"><span class="kwd">final</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> accessOrder</span><span class="pun">;</span></code></li><li class="L0"><code class="language-java"></code></li><li class="L1"><code class="language-java"><span class="com">//双向Entry链表，内部静态类</span></code></li><li class="L2"><code class="language-java"><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Entry</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">.</span><span class="typ">Node</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="language-java"><span class="pln">    </span><span class="typ">Entry</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> before</span><span class="pun">,</span><span class="pln"> after</span><span class="pun">;</span></code></li><li class="L4"><code class="language-java"><span class="pln">    </span><span class="typ">Entry</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> hash</span><span class="pun">,</span><span class="pln"> K key</span><span class="pun">,</span><span class="pln"> V value</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Node</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> next</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="language-java"><span class="pln">        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln">hash</span><span class="pun">,</span><span class="pln"> key</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> next</span><span class="pun">);</span></code></li><li class="L6"><code class="language-java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code class="language-java"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="r3xr" id="1-linkedhashmap">(1) LinkedHashMap</h2><p data-anchor-id="11io">如果是false，则循环输出的顺序是插入节点的顺序。若为true，则输出的顺序是按照访问节点的顺序。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ldg9"><ol class="linenums"><li class="L0"><code class="language-java"><span class="kwd">public</span><span class="pln"> </span><span class="typ">LinkedHashMap</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-java"></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span class="com">//调用父类构造函数</span></code></li><li class="L3"><code class="language-java"><span class="pln">    </span><span class="kwd">super</span><span class="pun">();</span></code></li><li class="L4"><code class="language-java"><span class="pln">    accessOrder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L5"><code class="language-java"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="caig" id="2-linknodelast">(2) linkNodeLast</h2><p data-anchor-id="pcbg">将一个结点链接到链表尾部，如果链表为空，则设置为表头和表位结点。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="u6tz"><ol class="linenums"><li class="L0"><code class="language-java"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> linkNodeLast</span><span class="pun">(</span><span class="typ">LinkedHashMap</span><span class="pun">.</span><span class="typ">Entry</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-java"><span class="pln">    </span><span class="typ">LinkedHashMap</span><span class="pun">.</span><span class="typ">Entry</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> last </span><span class="pun">=</span><span class="pln"> tail</span><span class="pun">;</span></code></li><li class="L2"><code class="language-java"><span class="pln">    tail </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">;</span></code></li><li class="L3"><code class="language-java"></code></li><li class="L4"><code class="language-java"><span class="pln">    </span><span class="com">//空表则把表头也指向p结点</span></code></li><li class="L5"><code class="language-java"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">last </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span></code></li><li class="L6"><code class="language-java"><span class="pln">        head </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">;</span></code></li><li class="L7"><code class="language-java"><span class="pln">    </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code class="language-java"><span class="pln">        p</span><span class="pun">.</span><span class="pln">before </span><span class="pun">=</span><span class="pln"> last</span><span class="pun">;</span></code></li><li class="L9"><code class="language-java"><span class="pln">        last</span><span class="pun">.</span><span class="pln">after </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">;</span></code></li><li class="L0"><code class="language-java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code class="language-java"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="2x7g" id="3-reinitialize">(3) reinitialize</h2><p data-anchor-id="pe9p">调用HashMap的重新初始化访华，清除所有数据，表头表位置空。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="pbox"><ol class="linenums"><li class="L0"><code class="language-java"><span class="kwd">void</span><span class="pln"> reinitialize</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-java"><span class="pln">    </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">reinitialize</span><span class="pun">();</span></code></li><li class="L2"><code class="language-java"><span class="pln">    head </span><span class="pun">=</span><span class="pln"> tail </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L3"><code class="language-java"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="7svr" id="4-newnode">(4) newNode</h2><p data-anchor-id="6ahz">传入参数，创建一个新的结点，然后链接到链表尾部。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="z6a6"><ol class="linenums"><li class="L0"><code class="language-java"><span class="typ">Node</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> newNode</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> hash</span><span class="pun">,</span><span class="pln"> K key</span><span class="pun">,</span><span class="pln"> V value</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Node</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-java"><span class="pln">    </span><span class="typ">LinkedHashMap</span><span class="pun">.</span><span class="typ">Entry</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> p </span><span class="pun">=</span></code></li><li class="L2"><code class="language-java"><span class="pln">        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">LinkedHashMap</span><span class="pun">.</span><span class="typ">Entry</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;(</span><span class="pln">hash</span><span class="pun">,</span><span class="pln"> key</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> e</span><span class="pun">);</span></code></li><li class="L3"><code class="language-java"><span class="pln">    linkNodeLast</span><span class="pun">(</span><span class="pln">p</span><span class="pun">);</span></code></li><li class="L4"><code class="language-java"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> p</span><span class="pun">;</span></code></li><li class="L5"><code class="language-java"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="d452" id="5-afternoderemoval">(5) afterNodeRemoval</h2><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="lnm1"><ol class="linenums"><li class="L0"><code class="language-java"><span class="com">//在删除节点e时，同步将e从双向链表上删除</span></code></li><li class="L1"><code class="language-java"><span class="kwd">void</span><span class="pln"> afterNodeRemoval</span><span class="pun">(</span><span class="typ">Node</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="com">// unlink</span></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span class="typ">LinkedHashMap</span><span class="pun">.</span><span class="typ">Entry</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> p </span><span class="pun">=</span></code></li><li class="L3"><code class="language-java"><span class="pln">        </span><span class="pun">(</span><span class="typ">LinkedHashMap</span><span class="pun">.</span><span class="typ">Entry</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;)</span><span class="pln">e</span><span class="pun">,</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">before</span><span class="pun">,</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">after</span><span class="pun">;</span></code></li><li class="L4"><code class="language-java"></code></li><li class="L5"><code class="language-java"><span class="pln">    </span><span class="com">//待删除节点 p 的前置后置节点都置空</span></code></li><li class="L6"><code class="language-java"><span class="pln">    p</span><span class="pun">.</span><span class="pln">before </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">after </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L7"><code class="language-java"></code></li><li class="L8"><code class="language-java"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">b </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span></code></li><li class="L9"><code class="language-java"><span class="pln">        head </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">;</span></code></li><li class="L0"><code class="language-java"><span class="pln">    </span><span class="kwd">else</span></code></li><li class="L1"><code class="language-java"><span class="pln">        b</span><span class="pun">.</span><span class="pln">after </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">;</span></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span></code></li><li class="L3"><code class="language-java"><span class="pln">        tail </span><span class="pun">=</span><span class="pln"> b</span><span class="pun">;</span></code></li><li class="L4"><code class="language-java"><span class="pln">    </span><span class="kwd">else</span></code></li><li class="L5"><code class="language-java"><span class="pln">        a</span><span class="pun">.</span><span class="pln">before </span><span class="pun">=</span><span class="pln"> b</span><span class="pun">;</span></code></li><li class="L6"><code class="language-java"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="a79c" id="6-get">(6) get</h2><p data-anchor-id="dfrx">基本是调用了HashMap中的实现，LinkedHashMap只是增加了在成员变量(构造函数时赋值)accessOrder为true的情况下，要去回调void afterNodeAccess(Node e)函数。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="b8tt"><ol class="linenums"><li class="L0"><code class="language-java"><span class="kwd">public</span><span class="pln"> V get</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> key</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-java"><span class="pln">    </span><span class="typ">Node</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> e</span><span class="pun">;</span></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">e </span><span class="pun">=</span><span class="pln"> getNode</span><span class="pun">(</span><span class="pln">hash</span><span class="pun">(</span><span class="pln">key</span><span class="pun">),</span><span class="pln"> key</span><span class="pun">))</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span></code></li><li class="L3"><code class="language-java"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L4"><code class="language-java"></code></li><li class="L5"><code class="language-java"><span class="pln">    </span><span class="com">//判断是否回调</span></code></li><li class="L6"><code class="language-java"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">accessOrder</span><span class="pun">)</span></code></li><li class="L7"><code class="language-java"><span class="pln">        afterNodeAccess</span><span class="pun">(</span><span class="pln">e</span><span class="pun">);</span></code></li><li class="L8"><code class="language-java"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">value</span><span class="pun">;</span></code></li><li class="L9"><code class="language-java"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="74c5" id="7-containsvalue">(7) containsValue</h2><p data-anchor-id="8smi">判断集合中是否含有指定元素。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="25se"><ol class="linenums"><li class="L0"><code class="language-java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> containsValue</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-java"></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span class="com">//循环遍历Entry，然后用equals比较，查找成功返回true</span></code></li><li class="L3"><code class="language-java"><span class="pln">    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="typ">LinkedHashMap</span><span class="pun">.</span><span class="typ">Entry</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> e </span><span class="pun">=</span><span class="pln"> head</span><span class="pun">;</span><span class="pln"> e </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln"> e </span><span class="pun">=</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">after</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-java"><span class="pln">        V v </span><span class="pun">=</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">value</span><span class="pun">;</span></code></li><li class="L5"><code class="language-java"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">v </span><span class="pun">==</span><span class="pln"> value </span><span class="pun">||</span><span class="pln"> </span><span class="pun">(</span><span class="pln">value </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> value</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln">v</span><span class="pun">)))</span></code></li><li class="L6"><code class="language-java"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L7"><code class="language-java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8"><code class="language-java"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L9"><code class="language-java"><span class="pun">}</span></code></li></ol></pre></div>
</body>
</html>