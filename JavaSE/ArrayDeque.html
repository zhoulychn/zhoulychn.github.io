<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
<title>ArrayDeque</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
<style type="text/css">

#wmd-preview h1  {
    color: #0077bb; /* 将标题改为蓝色 */
}</style>
</head>
<body class="theme theme-white">
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="bbjm" id="arraydeque">ArrayDeque</h1><p data-anchor-id="13hp"><code>集合</code></p><p data-anchor-id="9clr"><a href="http://zhoulychn.github.io/JavaSE/center.html" target="_blank">点击返回导航页</a></p><hr><p data-anchor-id="69h3"><div class="toc"><div class="toc">
<ul>
<li><a href="#arraydeque">ArrayDeque</a><ul>
<li><a href="#基本结构">基本结构</a></li>
<li><a href="#1-allocateelements">(1) allocateElements</a></li>
<li><a href="#2-addfirst">(2) addFirst</a></li>
<li><a href="#3-addlast">(3)  addLast</a></li>
<li><a href="#4-doublecapacity">(4) doubleCapacity</a></li>
<li><a href="#5-pollfirst">(5) pollFirst</a></li>
<li><a href="#6-polllast">(6) pollLast</a></li>
<li><a href="#7-contains">(7) contains</a></li>
<li><a href="#8-remove">(8) remove</a></li>
</ul>
</li>
</ul>
</div>
</div>
</p><hr><div class="md-section-divider"></div><h2 data-anchor-id="pq9e" id="基本结构">基本结构</h2><p data-anchor-id="25qa"><strong>存储结构</strong>: <br>
<img src="http://static.zybuluo.com/zy380104192/c7cgyb0htgg6boyc76376qj5/u=3167705269,2556474436&amp;fm=27&amp;gp=0.jpg" alt="u=3167705269,2556474436&amp;fm=27&amp;gp=0.jpg-22.5kB"></p><p data-anchor-id="jwmm"><strong>继承结构</strong>: <br>
<img src="http://static.zybuluo.com/zy380104192/x7oz92dp7gr7cavx45dt5d4u/QQ%E6%88%AA%E5%9B%BE20180304185703.png" alt="QQ截图20180304185703.png-11.9kB" title=""></p><p data-anchor-id="cr4g">ArrayDeque底层通过数组实现，为了满足可以同时在数组两端插入或删除元素的需求，该数组还必须是循环的，即循环数组（CircularArray），也就是说数组的任何一点都可能被看作起点或者终点。</p><p data-anchor-id="rpyu">head指向首部元素，tail指向尾部元素的下一位置。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="g191"><ol class="linenums"><li class="L0"><code class="language-java"></code></li><li class="L1"><code class="language-java"><span class="kwd">transient</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> elements</span><span class="pun">;</span><span class="pln"> </span><span class="com">// non-private to simplify nested class access</span></code></li><li class="L2"><code class="language-java"></code></li><li class="L3"><code class="language-java"><span class="kwd">transient</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> head</span><span class="pun">;</span><span class="pln">  </span><span class="com">//头部索引</span></code></li><li class="L4"><code class="language-java"></code></li><li class="L5"><code class="language-java"><span class="kwd">transient</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> tail</span><span class="pun">;</span><span class="pln">  </span><span class="com">//尾部索引</span></code></li><li class="L6"><code class="language-java"></code></li><li class="L7"><code class="language-java"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MIN_INITIAL_CAPACITY </span><span class="pun">=</span><span class="pln"> </span><span class="lit">8</span><span class="pun">;</span><span class="pln">  </span><span class="com">//默认容量</span></code></li></ol></pre><p data-anchor-id="mrbk">插入过程中，head左移，tail右移；删除过程则相反。</p><p data-anchor-id="j2ga">插入是反向的，交汇则一定是空间满了。</p><p data-anchor-id="w1bv">扩容是将head右边-&gt;数组尾部和数组头部-&gt;tail重新按顺序排列到一个新容器中。</p><div class="md-section-divider"></div><h2 data-anchor-id="sl0v" id="1-allocateelements">(1) allocateElements</h2><p data-anchor-id="m98a">数组默认初始化长度为8，此长度可以在构造函数中指定，但是要调用以下方法保证数值为2次幂数。这段代码看起来十分复杂，作用是计算出一个与给定数值最接近的2次幂数。</p><p data-anchor-id="xwz9">具体实现：通过无符号右移再做或运算，尽量使所有二进制位都为1，最后的结果加1就是2次幂数了。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="0lwd"><ol class="linenums"><li class="L0"><code class="language-java"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> allocateElements</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> numElements</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-java"><span class="pln">    </span><span class="kwd">int</span><span class="pln"> initialCapacity </span><span class="pun">=</span><span class="pln"> MIN_INITIAL_CAPACITY</span><span class="pun">;</span></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span class="com">// Find the best power of two to hold elements.</span></code></li><li class="L3"><code class="language-java"><span class="pln">    </span><span class="com">// Tests "&lt;=" because arrays aren't kept full.</span></code></li><li class="L4"><code class="language-java"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">numElements </span><span class="pun">&gt;=</span><span class="pln"> initialCapacity</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="language-java"><span class="pln">        initialCapacity </span><span class="pun">=</span><span class="pln"> numElements</span><span class="pun">;</span></code></li><li class="L6"><code class="language-java"><span class="pln">        initialCapacity </span><span class="pun">|=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">initialCapacity </span><span class="pun">&gt;&gt;&gt;</span><span class="pln">  </span><span class="lit">1</span><span class="pun">);</span></code></li><li class="L7"><code class="language-java"><span class="pln">        initialCapacity </span><span class="pun">|=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">initialCapacity </span><span class="pun">&gt;&gt;&gt;</span><span class="pln">  </span><span class="lit">2</span><span class="pun">);</span></code></li><li class="L8"><code class="language-java"><span class="pln">        initialCapacity </span><span class="pun">|=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">initialCapacity </span><span class="pun">&gt;&gt;&gt;</span><span class="pln">  </span><span class="lit">4</span><span class="pun">);</span></code></li><li class="L9"><code class="language-java"><span class="pln">        initialCapacity </span><span class="pun">|=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">initialCapacity </span><span class="pun">&gt;&gt;&gt;</span><span class="pln">  </span><span class="lit">8</span><span class="pun">);</span></code></li><li class="L0"><code class="language-java"><span class="pln">        initialCapacity </span><span class="pun">|=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">initialCapacity </span><span class="pun">&gt;&gt;&gt;</span><span class="pln"> </span><span class="lit">16</span><span class="pun">);</span></code></li><li class="L1"><code class="language-java"><span class="pln">        initialCapacity</span><span class="pun">++;</span></code></li><li class="L2"><code class="language-java"></code></li><li class="L3"><code class="language-java"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">initialCapacity </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">   </span><span class="com">// Too many elements, must back off</span></code></li><li class="L4"><code class="language-java"><span class="pln">            initialCapacity </span><span class="pun">&gt;&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="com">// Good luck allocating 2 ^ 30 elements</span></code></li><li class="L5"><code class="language-java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6"><code class="language-java"><span class="pln">    elements </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[</span><span class="pln">initialCapacity</span><span class="pun">];</span></code></li><li class="L7"><code class="language-java"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="8uf9" id="2-addfirst">(2) addFirst</h2><p data-anchor-id="nda5">此方法作用是在队列的首端插入元素，也就是在head的前面插入元素，在空间足够且下标没有越界的情况下，只需要将elements[--head] = e即可。</p><p data-anchor-id="nezg">但是循环数组不同，如果head为0之后接着调用addFirst()，虽然空余空间还够用，但head为-1，下标越界了。下列代码很好的解决了这两个问题。</p><p data-anchor-id="vwtl">两者效果相同：(head - 1) &amp; (length - 1) &lt;=&gt; (head - 1) % (length - 1)</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="70nq"><ol class="linenums"><li class="L0"><code class="language-java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addFirst</span><span class="pun">(</span><span class="pln">E e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-java"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span></code></li><li class="L2"><code class="language-java"><span class="pln">        </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NullPointerException</span><span class="pun">();</span></code></li><li class="L3"><code class="language-java"></code></li><li class="L4"><code class="language-java"><span class="pln">    </span><span class="com">//head-1为正数，结果还是为head-1;如果是负数，结果elements.length-1(数组末尾)</span></code></li><li class="L5"><code class="language-java"></code></li><li class="L6"><code class="language-java"><span class="pln">    elements</span><span class="pun">[</span><span class="pln">head </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">head </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">elements</span><span class="pun">.</span><span class="pln">length </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> e</span><span class="pun">;</span></code></li><li class="L7"><code class="language-java"></code></li><li class="L8"><code class="language-java"><span class="pln">    </span><span class="com">//添加元素后判断，头尾相遇说明集合已满，进行扩容</span></code></li><li class="L9"><code class="language-java"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">head </span><span class="pun">==</span><span class="pln"> tail</span><span class="pun">)</span></code></li><li class="L0"><code class="language-java"><span class="pln">        doubleCapacity</span><span class="pun">();</span><span class="pln">  </span><span class="com">//，</span></code></li><li class="L1"><code class="language-java"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="0b9q">上述代码我们看到，空间问题是在插入之后解决的，因为tail总是指向下一个可插入的空位，也就意味着elements数组至少有一个空位，所以插入元素的时候不用考虑空间问题。</p><div class="md-section-divider"></div><h2 data-anchor-id="ic6q" id="3-addlast">(3)  addLast</h2><p data-anchor-id="s5nz">此方法作用是在Deque的尾端插入元素，也就是在tail的位置插入元素，由于tail总是指向下一个可以插入的空位，因此只需要elements[tail]=e即可。插入完成后再检查空间，如果空间已经用光，则调用doubleCapacity()进行扩容。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="zy9y"><ol class="linenums"><li class="L0"><code class="language-java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addLast</span><span class="pun">(</span><span class="pln">E e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-java"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span></code></li><li class="L2"><code class="language-java"><span class="pln">        </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NullPointerException</span><span class="pun">();</span></code></li><li class="L3"><code class="language-java"><span class="pln">    elements</span><span class="pun">[</span><span class="pln">tail</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> e</span><span class="pun">;</span><span class="pln">  </span><span class="com">//直接赋值，再移动索引</span></code></li><li class="L4"><code class="language-java"></code></li><li class="L5"><code class="language-java"><span class="pln">    </span><span class="com">//如果下一位置与head相遇，则集合已满，进行扩容</span></code></li><li class="L6"><code class="language-java"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tail </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tail </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">elements</span><span class="pun">.</span><span class="pln">length </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">))</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> head</span><span class="pun">)</span></code></li><li class="L7"><code class="language-java"><span class="pln">        doubleCapacity</span><span class="pun">();</span></code></li><li class="L8"><code class="language-java"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="8nq1" id="4-doublecapacity">(4) doubleCapacity</h2><p data-anchor-id="i1ay">插入操作后扩容的具体实现方法，扩容之后要保证队头元素在第一个，并且由于是循环数组。head指向队头元素，后续都在其右边。tail指向队尾，前驱在其左边。拼接方式如下：</p><p data-anchor-id="qegv">第一部分：head到数组末尾的元素。</p><p data-anchor-id="5z0d">第二部分：head到数组开头的元素。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="mux7"><ol class="linenums"><li class="L0"><code class="language-java"><span class="kwd">private</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> doubleCapacity</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-java"><span class="pln">    </span><span class="kwd">assert</span><span class="pln"> head </span><span class="pun">==</span><span class="pln"> tail</span><span class="pun">;</span></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span class="kwd">int</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> head</span><span class="pun">;</span></code></li><li class="L3"><code class="language-java"><span class="pln">    </span><span class="kwd">int</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> elements</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></code></li><li class="L4"><code class="language-java"><span class="pln">    </span><span class="kwd">int</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">-</span><span class="pln"> p</span><span class="pun">;</span><span class="pln"> </span><span class="com">// number of elements to the right of p</span></code></li><li class="L5"><code class="language-java"><span class="pln">    </span><span class="kwd">int</span><span class="pln"> newCapacity </span><span class="pun">=</span><span class="pln"> n </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></code></li><li class="L6"><code class="language-java"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">newCapacity </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span></code></li><li class="L7"><code class="language-java"><span class="pln">        </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IllegalStateException</span><span class="pun">(</span><span class="str">"Sorry, deque too big"</span><span class="pun">);</span></code></li><li class="L8"><code class="language-java"><span class="pln">    </span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[</span><span class="pln">newCapacity</span><span class="pun">];</span></code></li><li class="L9"><code class="language-java"><span class="pln">    </span><span class="typ">System</span><span class="pun">.</span><span class="pln">arraycopy</span><span class="pun">(</span><span class="pln">elements</span><span class="pun">,</span><span class="pln"> p</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">);</span><span class="pln">  </span><span class="com">//第一部分，长度r=length-p</span></code></li><li class="L0"><code class="language-java"><span class="pln">    </span><span class="typ">System</span><span class="pun">.</span><span class="pln">arraycopy</span><span class="pun">(</span><span class="pln">elements</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> r</span><span class="pun">,</span><span class="pln"> p</span><span class="pun">);</span><span class="pln">  </span><span class="com">//第一部分，长度为p</span></code></li><li class="L1"><code class="language-java"><span class="pln">    elements </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">;</span></code></li><li class="L2"><code class="language-java"><span class="pln">    head </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L3"><code class="language-java"><span class="pln">    tail </span><span class="pun">=</span><span class="pln"> n</span><span class="pun">;</span></code></li><li class="L4"><code class="language-java"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="wc4m" id="5-pollfirst">(5) pollFirst</h2><p data-anchor-id="vupy">队头元素出队，如果队列为空返回null，先取元素，再移动索引。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="vjea"><ol class="linenums"><li class="L0"><code class="language-java"><span class="kwd">public</span><span class="pln"> E pollFirst</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-java"><span class="pln">    </span><span class="kwd">int</span><span class="pln"> h </span><span class="pun">=</span><span class="pln"> head</span><span class="pun">;</span></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span class="lit">@SuppressWarnings</span><span class="pun">(</span><span class="str">"unchecked"</span><span class="pun">)</span></code></li><li class="L3"><code class="language-java"><span class="pln">    E result </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">E</span><span class="pun">)</span><span class="pln"> elements</span><span class="pun">[</span><span class="pln">h</span><span class="pun">];</span></code></li><li class="L4"><code class="language-java"><span class="pln">    </span><span class="com">// Element is null if deque empty</span></code></li><li class="L5"><code class="language-java"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">result </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span></code></li><li class="L6"><code class="language-java"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L7"><code class="language-java"><span class="pln">    elements</span><span class="pun">[</span><span class="pln">h</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">     </span><span class="com">// Must null out slot</span></code></li><li class="L8"><code class="language-java"><span class="pln">    head </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">h </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">elements</span><span class="pun">.</span><span class="pln">length </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="pln">  </span><span class="com">//head右移一位</span></code></li><li class="L9"><code class="language-java"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> result</span><span class="pun">;</span></code></li><li class="L0"><code class="language-java"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="tiir" id="6-polllast">(6) pollLast</h2><p data-anchor-id="53n0">队尾元素出队，先取元素，再移动索引。同样地，如果队列为空返回null。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="fy3l"><ol class="linenums"><li class="L0"><code class="language-java"><span class="kwd">public</span><span class="pln"> E pollLast</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-java"><span class="pln">    </span><span class="kwd">int</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tail </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">elements</span><span class="pun">.</span><span class="pln">length </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span class="lit">@SuppressWarnings</span><span class="pun">(</span><span class="str">"unchecked"</span><span class="pun">)</span></code></li><li class="L3"><code class="language-java"><span class="pln">    E result </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">E</span><span class="pun">)</span><span class="pln"> elements</span><span class="pun">[</span><span class="pln">t</span><span class="pun">];</span></code></li><li class="L4"><code class="language-java"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">result </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span></code></li><li class="L5"><code class="language-java"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L6"><code class="language-java"><span class="pln">    elements</span><span class="pun">[</span><span class="pln">t</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></code></li><li class="L7"><code class="language-java"><span class="pln">    tail </span><span class="pun">=</span><span class="pln"> t</span><span class="pun">;</span></code></li><li class="L8"><code class="language-java"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> result</span><span class="pun">;</span></code></li><li class="L9"><code class="language-java"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="innh" id="7-contains">(7) contains</h2><p data-anchor-id="8ewd">判断队列中是否含有与指定元素等价的元素，通过遍历这个循环队列查找。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="b8l9"><ol class="linenums"><li class="L0"><code class="language-java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> contains</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-java"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span></code></li><li class="L2"><code class="language-java"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L3"><code class="language-java"><span class="pln">    </span><span class="kwd">int</span><span class="pln"> mask </span><span class="pun">=</span><span class="pln"> elements</span><span class="pun">.</span><span class="pln">length </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></code></li><li class="L4"><code class="language-java"><span class="pln">    </span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> head</span><span class="pun">;</span></code></li><li class="L5"><code class="language-java"><span class="pln">    </span><span class="typ">Object</span><span class="pln"> x</span><span class="pun">;</span></code></li><li class="L6"><code class="language-java"></code></li><li class="L7"><code class="language-java"><span class="pln">    </span><span class="com">//此处循环的方法很新颖，在判断条件中赋值。</span></code></li><li class="L8"><code class="language-java"><span class="pln">    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">=</span><span class="pln"> elements</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="language-java"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">o</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln">x</span><span class="pun">))</span></code></li><li class="L0"><code class="language-java"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L1"><code class="language-java"><span class="pln">        i </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> mask</span><span class="pun">;</span><span class="pln">  </span><span class="com">//到达末尾时重置为开头位置。</span></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code class="language-java"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L4"><code class="language-java"><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="19c7" id="8-remove">(8) remove</h2><p data-anchor-id="alp9">队列中查找等价元素，然后删除。这种删除操作在队列中比较少见。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="217k"><ol class="linenums"><li class="L0"><code class="language-java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> removeFirstOccurrence</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-java"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">o </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span></code></li><li class="L2"><code class="language-java"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L3"><code class="language-java"><span class="pln">    </span><span class="kwd">int</span><span class="pln"> mask </span><span class="pun">=</span><span class="pln"> elements</span><span class="pun">.</span><span class="pln">length </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">  </span><span class="com">//循环遍历中使用</span></code></li><li class="L4"><code class="language-java"><span class="pln">    </span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> head</span><span class="pun">;</span></code></li><li class="L5"><code class="language-java"><span class="pln">    </span><span class="typ">Object</span><span class="pln"> x</span><span class="pun">;</span></code></li><li class="L6"><code class="language-java"><span class="pln">    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">=</span><span class="pln"> elements</span><span class="pun">[</span><span class="pln">i</span><span class="pun">])</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="language-java"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">o</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln">x</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span><span class="com">//equals判断对象等价，查找到就删除，然后对队列进行调整。</span></code></li><li class="L8"><code class="language-java"><span class="pln">            </span><span class="kwd">delete</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span></code></li><li class="L9"><code class="language-java"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L0"><code class="language-java"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L1"><code class="language-java"><span class="pln">        i </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> mask</span><span class="pun">;</span></code></li><li class="L2"><code class="language-java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code class="language-java"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L4"><code class="language-java"><span class="pun">}</span></code></li></ol></pre></div>
</body>
</html>